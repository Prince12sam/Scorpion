"""
Aggressive Exploitation Configuration
Enhances AI pentest with maximum exploitation capabilities
"""

# Aggressive exploitation settings
AGGRESSIVE_CONFIG = {
    # Exploitation attempts
    "max_exploit_attempts_per_vuln": 10,  # Try 10 different payloads per vulnerability
    "exploit_timeout": 60,  # 60 seconds per exploit attempt
    "retry_failed_exploits": True,  # Retry failed exploits with different techniques
    
    # Payload variants
    "use_all_payload_encodings": True,  # Try all encodings: raw, URL, base64, hex, unicode
    "use_obfuscation": True,  # Obfuscate payloads to bypass WAF/IDS
    "use_polyglot_payloads": True,  # Use payloads that work across multiple contexts
    
    # Shell access strategies
    "shell_strategies": [
        "reverse_shell_bash",
        "reverse_shell_python",
        "reverse_shell_perl",
        "reverse_shell_php",
        "reverse_shell_powershell",
        "bind_shell",
        "web_shell_upload",
        "sqli_os_command",
        "rce_direct",
        "deserialization",
        "xxe_with_oob",
        "ssti_os_command"
    ],
    
    # File upload variations
    "file_upload_extensions": [
        ".php", ".php3", ".php4", ".php5", ".php7", ".pht", ".phtml", ".phar",
        ".inc", ".phps", ".jsp", ".jspx", ".jsw", ".jsv", ".jspf",
        ".asp", ".aspx", ".asa", ".asax", ".ascx", ".ashx", ".asmx",
        ".cer", ".swf", ".htaccess", ".sh", ".py", ".pl", ".cgi",
        ".jpg.php", ".png.php", ".gif.php", ".pdf.php",  # Double extension
        ".php.jpg", ".php.png", ".php.gif",  # Reverse double extension
        ".php%00.jpg", ".php\x00.jpg",  # Null byte injection
        "shell.php\n.jpg",  # Newline bypass
        "shell.php%0a.jpg",  # URL-encoded newline
    ],
    
    # Content-type bypass
    "file_upload_content_types": [
        "image/jpeg",
        "image/png",
        "image/gif",
        "application/octet-stream",
        "text/plain",
        "application/x-php",
        "application/x-httpd-php",
    ],
    
    # SQLi exploitation techniques
    "sqli_techniques": [
        "union_select",
        "boolean_blind",
        "time_blind",
        "error_based",
        "stacked_queries",
        "out_of_band",
        "second_order",
    ],
    
    # SQLi OS command execution
    "sqli_os_commands": {
        "mysql": [
            "sys_exec",
            "INTO OUTFILE",
            "INTO DUMPFILE",
            "LOAD_FILE",
        ],
        "mssql": [
            "xp_cmdshell",
            "sp_OACreate",
            "xp_regwrite",
        ],
        "postgresql": [
            "COPY TO PROGRAM",
            "CREATE FUNCTION",
            "pg_read_file",
        ],
        "oracle": [
            "DBMS_SCHEDULER",
            "UTL_FILE",
        ],
    },
    
    # RCE payload variations
    "rce_payloads_multiplier": 5,  # Generate 5x more payload variants
    "use_encoding_chains": True,  # Chain multiple encodings (base64 + URL + hex)
    
    # Evasion techniques
    "evasion_techniques": [
        "case_variation",  # SeLeCt, sElEcT
        "comment_injection",  # SE/**/LECT
        "whitespace_variation",  # SELECT\t\r\n
        "concatenation",  # 'SE'+'LECT'
        "hex_encoding",  # 0x53454c454354
        "unicode_encoding",  # \u0053\u0045\u004c\u0045\u0043\u0054
        "double_encoding",  # URL encode twice
        "null_byte_injection",  # %00
        "newline_injection",  # %0a, %0d
    ],
    
    # Brute force settings
    "bruteforce_max_passwords": 100,  # Test up to 100 passwords
    "bruteforce_common_usernames": [
        "admin", "administrator", "root", "user", "test", "guest",
        "demo", "webadmin", "sysadmin", "netadmin", "support",
        "backup", "postgres", "mysql", "oracle", "mssql", "tomcat"
    ],
    "bruteforce_common_passwords": [
        "admin", "password", "123456", "12345678", "password123",
        "admin123", "root", "toor", "pass", "test", "guest",
        "welcome", "qwerty", "abc123", "letmein", "monkey",
        "1234567890", "Password1", "Admin123!", "P@ssw0rd",
        # Default vendor passwords
        "changeme", "default", "password1", "admin1", "root123",
        # Database defaults
        "postgres", "mysql", "oracle", "sa", "sqlserver",
        # Application defaults
        "tomcat", "manager", "weblogic", "admin123456"
    ],
    
    # Privilege escalation
    "attempt_privilege_escalation": True,
    "privesc_techniques": [
        "sudo_misconfiguration",
        "suid_binaries",
        "kernel_exploits",
        "service_exploits",
        "path_hijacking",
        "dll_hijacking",  # Windows
        "token_impersonation",  # Windows
    ],
    
    # Persistence mechanisms
    "establish_persistence": True,
    "persistence_techniques": [
        "cron_job",
        "startup_script",
        "backdoor_user",
        "ssh_key_injection",
        "web_shell_hidden",
        "scheduled_task",  # Windows
        "registry_run_key",  # Windows
    ],
    
    # Lateral movement
    "attempt_lateral_movement": True,
    "lateral_techniques": [
        "password_reuse",
        "ssh_key_reuse",
        "network_scanning",
        "arp_poisoning",
        "smb_relay",
        "pass_the_hash",  # Windows
        "kerberoasting",  # Windows
    ],
    
    # Post-exploitation
    "enumerate_system": True,
    "dump_credentials": True,
    "search_sensitive_files": True,
    "map_network": True,
    
    # Timing and stealth
    "aggressive_timing": {
        "paranoid": 0.1,  # Super fast (0.1s delay)
        "sneaky": 0.05,
        "polite": 0.01,
        "normal": 0,
        "aggressive": 0,
    },
    
    # Exploit chaining
    "chain_exploits": True,  # Automatically chain vulnerabilities
    "exploit_chains": [
        ["sqli", "rce"],  # SQLi â†’ OS command execution
        ["xss", "csrf", "account_takeover"],  # XSS â†’ CSRF â†’ Admin access
        ["lfi", "log_poisoning", "rce"],  # LFI â†’ Log poison â†’ RCE
        ["file_upload", "path_traversal", "rce"],  # Upload â†’ Traverse â†’ Execute
        ["ssrf", "cloud_metadata", "credential_theft"],  # SSRF â†’ Cloud creds
    ],
    
    # Advanced exploitation
    "use_metasploit_modules": False,  # Integrate with Metasploit (if available)
    "use_custom_exploits": True,  # Use custom exploit code
    "attempt_zero_days": False,  # Attempt known 0-day techniques (use with caution!)
    
    # Reporting
    "include_exploit_proof": True,  # Include proof of exploitation (screenshots, command output)
    "include_remediation_code": True,  # Provide code-level fixes
    "include_payload_analysis": True,  # Explain how each payload works
}

# Aggressive AI decision-making prompts
AGGRESSIVE_AI_PROMPTS = {
    "exploitation_directive": """
ðŸ”¥ AGGRESSIVE EXPLOITATION MODE ACTIVATED ðŸ”¥

PRIMARY OBJECTIVE: GAIN SHELL ACCESS

Exploitation Priority Order:
1. RCE (Remote Code Execution) - HIGHEST priority, immediate shell access
2. SQLi with OS commands - Use xp_cmdshell, sys_exec, INTO OUTFILE
3. File Upload â†’ Web Shell - Upload backdoors with multiple extensions
4. Command Injection - Direct OS command execution
5. Deserialization - Execute arbitrary code
6. SSRF â†’ Cloud Metadata â†’ RCE - Chain for cloud instance takeover

MANDATORY ACTIONS:
- Try ALL payload variants for each vulnerability (not just one!)
- Use multiple encodings: raw, URL, base64, hex, unicode, double-encoded
- Try ALL file extensions for uploads: .php, .php5, .phtml, .jpg.php, etc.
- Chain vulnerabilities: XSS â†’ admin session â†’ file upload â†’ shell
- If initial exploit fails, try evasion: case variation, comment injection, null bytes
- Establish persistence: backdoor user, SSH keys, hidden web shells
- Attempt privilege escalation: SUID, sudo, kernel exploits

DO NOT STOP after finding a vulnerability - EXPLOIT IT to gain shell!
DO NOT give up after first failed attempt - try alternate payload encodings!
DO NOT skip post-exploitation - enumerate, escalate, persist!

Success Criteria:
âœ… Interactive shell obtained (bash, powershell, cmd)
âœ… Can execute arbitrary commands (whoami, id, uname)
âœ… Proof of exploitation captured (command output, screenshots)
""",
    
    "payload_selection": """
When generating payloads, use MAXIMUM variation:
- Generate 5-10 different payload variants per vulnerability
- Try different shells: bash, python, perl, php, powershell, netcat
- Use different reverse shell techniques: /dev/tcp, python socket, powershell IEX
- For SQLi: Try UNION, boolean blind, time blind, error-based, stacked queries
- For file upload: Try 15+ extensions and 5+ content-types
- For RCE: Try raw, URL-encoded, base64, hex, unicode payloads
- Chain encodings: base64(url_encode(hex_encode(payload)))
""",
    
    "persistence_directive": """
After gaining shell access:
1. Establish persistence (cron, startup scripts, SSH keys)
2. Create backdoor user (if privilege escalation successful)
3. Upload hidden web shells (multiple locations)
4. Dump credentials (/etc/shadow, SAM, LSASS)
5. Enumerate network (arp -a, netstat, ip neigh)
6. Search for sensitive files (passwords, keys, configs)
""",
}

# Tool selection weights for aggressive mode
AGGRESSIVE_TOOL_WEIGHTS = {
    "exploit_vuln": 10.0,  # Highest priority - actually exploit
    "payload_generate": 9.0,  # Generate payloads immediately
    "web_pentest": 8.0,  # Find RCE/SQLi/Upload vulns
    "bruteforce": 7.0,  # Gain initial access
    "port_scan": 6.0,  # Find attack surface
    "nuclei": 5.0,  # Find known vulns
    "dirbuster": 4.0,  # Find upload endpoints
    "recon": 3.0,  # Lower priority in aggressive mode
    "tech_detect": 2.0,
    "os_fingerprint": 1.0,
}
